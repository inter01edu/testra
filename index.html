<!doctype html>
<html>
  <head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">

    <style>
      html, body, table, td, a, div {
        font-family: Gotham, "Gotham", Arial, sans-serif;
      }

      .copy-btn {
        padding: 6px 10px;
        border: 1px solid #ddd;
        border-radius: 8px;
        background: #fff;
        cursor: pointer;
        font-size: 12px;
      }
      .copy-btn:disabled {
        opacity: .6;
        cursor: default;
      }
    </style>
  </head>

  <body>
    <script>
      /* =========================
         CONFIG IMAGES (GitHub RAW)
         ========================= */
      const IMG_BASE =
        "https://raw.githubusercontent.com/inter01edu/01edusigngenerator/main/images/";

      function slugify(str) {
        return (str || "")
          .toLowerCase()
          .trim()
          .replace(/\s+/g, "-")
          .replace(/[^a-z0-9-]/g, "");
      }

      function toPublicImg(src) {
        if (!src) return src;
        if (src.startsWith("http")) return src;
        return IMG_BASE + src.replace(/^\.?\/*images\//, "");
      }

      function rewriteImages(root) {
        root.querySelectorAll("img").forEach(img => {
          img.setAttribute("src", toPublicImg(img.getAttribute("src")));
        });
      }

      function inlineStyles(root) {
        root.querySelectorAll("table, td, a, div, span").forEach(el => {
          el.style.fontFamily = "Gotham, Arial, sans-serif";
        });

        const logo = root.querySelector(".logo01edu img");
        if (logo) {
          logo.style.width = "100px";
          logo.style.maxWidth = "100px";
          logo.style.display = "block";
          logo.style.margin = "0 auto";
        }

        root.querySelectorAll(".social img").forEach(img => {
          img.style.width = "22px";
          img.style.height = "22px";
          img.style.display = "block";
        });

        root.querySelectorAll(".sig-text td").forEach(td => {
          td.style.fontSize = td.style.fontSize || "12px";
          td.style.lineHeight = "1.3";
          td.style.padding = "1px 0";
        });
      }

      async function copyHtml(html) {
        const plain = html.replace(/<[^>]*>/g, " ").replace(/\s+/g, " ").trim();
        await navigator.clipboard.write([
          new ClipboardItem({
            "text/html": new Blob([html], { type: "text/html" }),
            "text/plain": new Blob([plain], { type: "text/plain" })
          })
        ]);
      }

      async function onCopy(ev) {
        const btn = ev.currentTarget;
        const slug = btn.dataset.slug;
        const table = document.querySelector(`table[data-sig="${slug}"]`);
        if (!table) return;

        btn.disabled = true;
        btn.textContent = "Copyingâ€¦";

        try {
          const clone = table.cloneNode(true);
          rewriteImages(clone);
          inlineStyles(clone);
          await copyHtml(clone.outerHTML);
          btn.textContent = "Copied âœ“";
        } catch (e) {
          console.error(e);
          btn.textContent = "Error";
        }

        setTimeout(() => {
          btn.textContent = "Copy Signature";
          btn.disabled = false;
        }, 1000);
      }

      fetch("https://opensheet.elk.sh/1maVoCpxQUmelT_wpZzTZERPzW4y20zGeoLtQuxbFvXQ/1")
        .then(r => r.json())
        .then(users =>
          users.filter(Boolean).map(({ firstname, lastname, title, mobile }) => {
            const slug = slugify(`${firstname} ${lastname}`);

            return `
<div style="margin:12px 0">
  <div style="display:flex;align-items:center">
    <div style="flex-grow:1;height:1px;background:#eee"></div>
    <a href="#${slug}" style="margin-left:8px;color:#999;text-decoration:none">ðŸ”—</a>
  </div>

  <div style="margin:6px 0">
    <button class="copy-btn" data-slug="${slug}">Copy Signature</button>
  </div>

  <table data-sig="${slug}" cellpadding="0" cellspacing="0" border="0" style="width:100%;border-collapse:collapse">
    <tr>
      <td style="width:100px;text-align:center">
        <table cellpadding="0" cellspacing="0">
          <tr>
            <td class="logo01edu">
              <img src="./images/logo01edu.svg" alt="01Edu">
            </td>
          </tr>
          <tr><td height="6"></td></tr>
          <tr>
            <td class="social">
              <table cellpadding="0" cellspacing="0">
                <tr>
                  <td><img src="./images/linkedin.svg"></td>
                  <td><img src="./images/youtube.svg"></td>
                  <td><img src="./images/instagram.svg"></td>
                </tr>
              </table>
            </td>
          </tr>
        </table>
      </td>

      <td style="width:3px;background:#0063f9"></td>
      <td style="width:3px"></td>

      <td>
        <table class="sig-text">
          <tr><td style="font-size:12px">Recode Our World With</td></tr>
          <tr><td style="font-weight:bold;color:#0063f9">${firstname} ${lastname}</td></tr>
          <tr><td style="font-weight:bold;font-size:12px">${title}</td></tr>
          ${mobile ? `<tr><td style="font-size:12px">Mobile: ${mobile}</td></tr>` : ""}
          <tr><td style="font-size:12px"><a href="https://www.01edu.ai" style="color:#0063f9">www.01edu.ai</a></td></tr>
        </table>
      </td>
    </tr>

    <tr>
      <td colspan="4" style="padding-top:16px;font-size:12px;color:#666">
        Any electronic messages sent outside your regular working hours do not require a response until you return to your normal working hours.
      </td>
    </tr>
  </table>
</div>`;
          })
        )
        .then(html => {
          document.body.innerHTML += html.join("");
          document.querySelectorAll(".copy-btn")
            .forEach(btn => btn.addEventListener("click", onCopy));
        });
    </script>
  </body>
</html>
